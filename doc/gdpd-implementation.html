<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>GDP Daemon Implementation</title>
  </head>
  <body>
    <h1>Global Data Plane Daemon Internals</h1>
    2014-10-04<br>
    <p>This document describes the internals of the Global Data Plane
      (GDP) daemon (gdpd) at a conceptual level.&nbsp; It will also
      describe the hooks provided at the GDP library level for use by
      gdpd.&nbsp; See also the Global Data Plane Library Implementation
      document.<br>
    </p>
    <h2> Overview</h2>
    <p>Following are the major subsystems in gdpd:<br>
    </p>
    <ul>
      <li>Main Loop.</li>
      <li>Thread Pool.</li>
      <li>Protocol Processing.</li>
      <li>GCL Caching.</li>
      <li>Publish/Subscribe.<br>
      </li>
      <li>Physical Log Implementation.</li>
    </ul>
    <p>GCLs piggyback on the GCL implementation in the gdp library, with
      the addition of several fields accessed via the "x" pointer in
      gdp_gcl_t.&nbsp; The gdpd must use a special routine (gcl_alloc)
      to allocate the standard structure together with the extension
      structure.&nbsp; Generally gcl_alloc is called via gcl_open, which
      also opens the physical underlying log.<br>
    </p>
    <p></p>
    <h2>Module Details</h2>
    <p></p>
    <h3>Main Loop</h3>
    <h3>Thread Pool</h3>
    <h3>Protocol Processing</h3>
    <h3>GCL Caching</h3>
    <p>The gdpd GCL cache is tightly integrated with the gdp library GCL
      cache.&nbsp; The major differences are:<br>
    </p>
    <ol type="a">
      <li>GCLs in gdpd are included in a list sorted by last usage; this
        facilitates cleaning up resources using an LRU algorithm.&nbsp;
        They also have a "last usage time" using a standard Unix time_t
        (resolution one second).<br>
      </li>
      <li>GCLs in gdpd have the information needed to access the
        physical log on disk.</li>
    </ol>
    <p>Wrappers allocate and manipulate both the standard GCL and the
      extensions:<br>
    </p>
    <table width="100%" border="1" cellpadding="2" cellspacing="2">
      <tbody>
        <tr>
          <td valign="top">gcl_open<br>
          </td>
          <td valign="top">Allocates a new GCL handle including the
            extended data, opens the physical underlying GCL, and links
            it into the GclsByUse list (ordered by last usage).<br>
          </td>
        </tr>
        <tr>
          <td valign="top">gcl_close<br>
          </td>
          <td valign="top">Removes the GCL from the GclsByUse list,
            drops it from the GCL associative cache (maintained by the
            GDP library), and releases the resources used by the
            physical log (memory and open file descriptors).<br>
          </td>
        </tr>
        <tr>
          <td valign="top">gcl_touch<br>
          </td>
          <td valign="top">Moves the GCL to the head (most recently used
            end) of the GclsByUse list and updates the timestamp.<br>
          </td>
        </tr>
        <tr>
          <td valign="top">get_open_handle<br>
          </td>
          <td valign="top">Searches for a named GCL in the GCL
            associative cache; if found, touches it and returns.&nbsp;
            Otherwise, calls gcl_open to create a new GCL handle.<br>
          </td>
        </tr>
      </tbody>
    </table>
    <p>The usual path is to call the GDP Library function
      _gdp_gcl_decref to decrement the reference count on the GCL.&nbsp;
      If it reaches zero, that GCL is a candidate for being
      reclaimed.&nbsp; The GCL is reclaimed by calling the GDP library
      function _gdp_gcl_freehandle, which in turn calls the associated
      free function; in gdpd this is gcl_close, as described above.<br>
    </p>
    <h3>Publish/Subscribe</h3>
    <h3>Physical Log</h3>
    <h3> </h3>
  </body>
</html>
